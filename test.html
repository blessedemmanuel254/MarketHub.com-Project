<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Market Hub ‚Äì Order Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* {
  box-sizing: border-box;
  font-family: "Poppins", sans-serif;
}

body {
  margin: 0;
  display: flex;
  justify-content: center;
}

/* MAIN WRAPPER */
.chat-wrapper {
  width: 100%;
  max-width: 420px;
  height: 100vh;
  background: #dedede;
  background-image: url('/Images/Whatsapp\ default\ wallpaper.avif');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  display: flex;
  flex-direction: column;
  color: #fff;
}

/* HEADER */
.chat-header {
  padding: 14px;
  background: #151515;
  border-bottom: 1px solid #222;
}

.chat-header h3 {
  margin: 0;
  font-size: 15px;
}

.chat-header .meta {
  font-size: 12px;
  color: #aaa;
}

.status {
  margin-top: 4px;
  font-size: 12px;
  color: #088000;
}

/* CHAT BODY */
.chat-body {
  flex: 1;
  padding: 12px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}

.message {
  max-width: 75%;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 10px;
  font-size: 13px;
  line-height: 1.4;
}

.system {
  align-self: center;
  background: #1a1a1a;
  color: #aaa;
  font-size: 11px;
}

.location-link {
  font-size: 12px;
  color: #088000;
  text-decoration: underline;
}

.chat-body {
  flex: 1;
  padding: 15px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* MESSAGE CONTAINER */
.chat-message {
  display: flex;
  animation: fadeIn 0.2s ease-in-out;
}

/* ALIGNMENT */
.chat-message.buyer {
  justify-content: flex-end;
}

.chat-message.seller {
  justify-content: flex-start;
}

/* BUBBLE */
.bubble {
  position: relative;
  max-width: 75%;
  padding: 8px 12px;
  border-radius: 18px;
  font-size: 13px;
  line-height: 1.4;
  word-wrap: break-word;
  border: 1px solid #dedede;
}

/* BUYER STYLE */
.chat-message.buyer .bubble {
  background: #beffb9;
  color: #0f0f0f;
  border-bottom-right-radius: 0;
}

/* SELLER STYLE */
.chat-message.seller .bubble {
  background: #ffffff;
  color: #0f0f0f;
  border-bottom-left-radius: 0;
}

/* TIME */
.time {
  display: block;
  font-size: 10px;
  opacity: 0.6;
  margin-top: 4px;
  text-align: right;
}

/* ANIMATION */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(5px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* FOOTER */
.chat-footer {
  padding: 10px;
  background: #ffffff;
}

.chat-actions {
  display: flex;
  gap: 6px;
  margin-bottom: 6px;
}

.chat-actions button {
  flex: 1;
  padding: 8px;
  border: none;
  border-radius: 6px;
  font-size: 12px;
  cursor: pointer;
}

.location-btn {
  background: #333;
  color: #fff;
}

.complete-btn {
  background: #ff3b3b;
  color: #ffffff;
}

.chat-input {
  display: flex;
  gap: 4px;
}

.chat-input input {
  flex: 1;
  padding: 8px;
  border-radius: 6px;
  border: none;
  outline: none;
  border: 1px solid #dedede;
}

.send-btn {
  background: #0f0f0f;
  color: #ffffff;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
}

/* LOCKED */
.locked {
  opacity: 0.5;
  pointer-events: none;
}
</style>
</head>

<body>

<div class="chat-wrapper">

  <!-- HEADER -->
  <div class="chat-header">
    <h3>Order Chat ‚Ä¢ Seller: Alex</h3>
    <div class="meta">Item: Office Chair (Rental ‚Ä¢ 3 Days)</div>
    <div class="status" id="orderStatus">Order in progress</div>
  </div>

  <!-- CHAT BODY -->
  <div class="chat-body" id="chatBody">

    <!-- Seller Message -->
    <div class="chat-message seller">
      <div class="bubble">
        Hello üëã I‚Äôm ready to deliver your product.
        <span class="time">10:32 AM</span>
      </div>
    </div>

  </div>

  <!-- FOOTER -->
  <div class="chat-footer" id="chatFooter">

    <div class="chat-actions">
      <button class="location-btn" onclick="shareLocation()">üìç Share Location</button>
      <button class="complete-btn" onclick="completeOrder()">‚úî I have Received Order</button>
    </div>

    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="Type a message..." />
      <button class="send-btn" onclick="sendMessage()">Send</button>
    </div>

  </div>

</div>

<script>
const chatBody = document.getElementById("chatBody");
const chatInput = document.getElementById("chatInput");
const orderStatus = document.getElementById("orderStatus");
const chatFooter = document.getElementById("chatFooter");

/* SEND MESSAGE */
function sendMessage() {
  const input = document.getElementById("chatInput");
  if (!input.value.trim()) return;

  const messageWrapper = document.createElement("div");
  messageWrapper.className = "chat-message buyer";

  const bubble = document.createElement("div");
  bubble.className = "bubble";

  const time = new Date().toLocaleTimeString([], {
    hour: '2-digit',
    minute: '2-digit'
  });

  bubble.innerHTML = `
    ${input.value}
    <span class="time">${time}</span>
  `;

  messageWrapper.appendChild(bubble);
  document.getElementById("chatBody").appendChild(messageWrapper);

  input.value = "";
  chatBody.scrollTop = chatBody.scrollHeight;
}

function shareLocation() {
  if (!navigator.geolocation) {
    alert("Geolocation not supported");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    function(pos) {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      const accuracy = pos.coords.accuracy; // meters

      const link = `https://www.google.com/maps?q=${lat},${lng}`;

      const time = new Date().toLocaleTimeString([], {
        hour: '2-digit',
        minute: '2-digit'
      });

      const messageWrapper = document.createElement("div");
      messageWrapper.className = "chat-message buyer";

      const bubble = document.createElement("div");
      bubble.className = "bubble";

      bubble.innerHTML = `
        üìç <strong>My location</strong><br>
        <a class="location-link" href="${link}" target="_blank">
          Open in Google Maps
        </a>
        <br><small>Accuracy: ¬±${Math.round(accuracy)}m</small>
        <span class="time">${time}</span>
      `;

      messageWrapper.appendChild(bubble);
      chatBody.appendChild(messageWrapper);
      chatBody.scrollTop = chatBody.scrollHeight;
    },
    function(error) {
      alert("Unable to retrieve location.");
    },
    {
      enableHighAccuracy: true,
      timeout: 10000,
      maximumAge: 0
    }
  );
}

/* COMPLETE ORDER */
function completeOrder() {
  if (!confirm("This will mark the order as completed and close the chat. Continue?")) return;

  orderStatus.textContent = "Order Completed ‚Ä¢ Chat Closed";
  orderStatus.style.color = "#ffb703";

  const systemMsg = document.createElement("div");
  systemMsg.className = "message system";
  systemMsg.textContent =
    "‚úÖ Order marked as completed. Chat has been closed.";
  chatBody.appendChild(systemMsg);

  chatFooter.classList.add("locked");
}
</script>

</body>
</html>